<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ace Job Agency - Change Password</title>
    <style>
        * {
   margin: 0;
 padding: 0;
    box-sizing: border-box;
        }

 body {
   font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
     padding: 20px;
        }

        .container {
 max-width: 500px;
         margin: 50px auto;
       background: white;
         padding: 40px;
border-radius: 10px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        h1 {
text-align: center;
color: #333;
  margin-bottom: 10px;
   }

        .subtitle {
          text-align: center;
  color: #666;
 margin-bottom: 30px;
   }

    .form-group {
            margin-bottom: 20px;
      }

 label {
  display: block;
      margin-bottom: 5px;
  color: #333;
   font-weight: 500;
     }

   label .required {
            color: red;
 }

        input[type="password"],
     input[type="text"] {
    width: 100%;
          padding: 12px;
 border: 1px solid #ddd;
            border-radius: 5px;
       font-size: 14px;
  transition: border-color 0.3s;
     }

        input:focus {
   outline: none;
            border-color: #667eea;
}

   button {
     width: 100%;
       padding: 15px;
   background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
   color: white;
      border: none;
        border-radius: 5px;
       font-size: 16px;
 font-weight: 600;
      cursor: pointer;
  transition: transform 0.2s;
      }

        button:hover {
  transform: translateY(-2px);
   }

button:disabled {
      opacity: 0.6;
cursor: not-allowed;
        }

   .error {
  color: #dc3545;
    font-size: 13px;
  margin-top: 5px;
        }

  .success {
 background-color: #d4edda;
            border: 1px solid #c3e6cb;
   color: #155724;
    padding: 15px;
      border-radius: 5px;
 margin-bottom: 20px;
 }

      .alert-error {
    background-color: #f8d7da;
            border: 1px solid #f5c6cb;
    color: #721c24;
 padding: 15px;
border-radius: 5px;
 margin-bottom: 20px;
   }

        .back-link {
      text-align: center;
margin-top: 20px;
        }

        .back-link a {
            color: #667eea;
  text-decoration: none;
    font-weight: 500;
        }

        .password-requirements {
 font-size: 12px;
            color: #666;
  margin-top: 5px;
 padding: 10px;
        background-color: #f8f9fa;
     border-radius: 5px;
        }

      .password-requirements ul {
    margin-left: 20px;
 margin-top: 5px;
        }

        .toggle-password {
      position: relative;
}

        .toggle-password button {
        position: absolute;
right: 10px;
   top: 50%;
        transform: translateY(-50%);
  background: none;
     border: none;
     color: #667eea;
   cursor: pointer;
   padding: 5px;
   width: auto;
    font-size: 12px;
   }

        .toggle-password button:hover {
        transform: translateY(-50%);
   text-decoration: underline;
    }
    </style>
</head>
<body>
    <div class="container">
    <h1>Ace Job Agency</h1>
     <p class="subtitle">Change Password</p>

        <div id="successMessage" style="display: none;" class="success"></div>
    <div id="errorMessage" style="display: none;" class="alert-error"></div>

   <form id="changePasswordForm">
   <div class="form-group">
         <label>Current Password <span class="required">*</span></label>
         <div class="toggle-password">
   <input type="password" id="currentPassword" name="currentPassword" required>
    <button type="button" onclick="togglePassword('currentPassword')">Show</button>
          </div>
     <div class="error" id="currentPasswordError"></div>
   </div>

       <div class="form-group">
      <label>New Password <span class="required">*</span></label>
     <div class="toggle-password">
  <input type="password" id="newPassword" name="newPassword" required>
              <button type="button" onclick="togglePassword('newPassword')">Show</button>
  </div>
  <div class="password-requirements">
       Password must contain:
    <ul>
       <li>At least 12 characters</li>
      <li>Uppercase and lowercase letters</li>
 <li>Numbers</li>
        <li>Special characters (!@#$%^&* etc.)</li>
            </ul>
      </div>
         <div class="error" id="newPasswordError"></div>
  </div>

        <div class="form-group">
 <label>Confirm New Password <span class="required">*</span></label>
<div class="toggle-password">
         <input type="password" id="confirmNewPassword" name="confirmNewPassword" required>
            <button type="button" onclick="togglePassword('confirmNewPassword')">Show</button>
     </div>
      <div class="error" id="confirmNewPasswordError"></div>
      </div>

   <button type="submit" id="submitBtn">Change Password</button>
        </form>

        <div class="back-link">
    <a href="profile.html">Back to Profile</a>
    </div>
</div>

 <script>
        function togglePassword(inputId) {
  const input = document.getElementById(inputId);
   const button = input.nextElementSibling;
            
            if (input.type === 'password') {
input.type = 'text';
      button.textContent = 'Hide';
       } else {
   input.type = 'password';
   button.textContent = 'Show';
   }
        }

        // Check if user is logged in by making a test request
        async function checkAuth() {
        try {
   const response = await fetch('https://localhost:7134/api/member/profile', {
          method: 'GET',
        credentials: 'include' // Include cookies
     });
   
        if (!response.ok) {
            // Not logged in, redirect to login
     window.location.href = 'login.html';
   }
     } catch (error) {
  console.error('Auth check failed:', error);
          window.location.href = 'login.html';
       }
        }

      // Check authentication on page load
        checkAuth();

        document.getElementById('changePasswordForm').addEventListener('submit', async function(e) {
        e.preventDefault();
          
      // Clear previous errors
        document.querySelectorAll('.error').forEach(el => el.textContent = '');
          document.getElementById('successMessage').style.display = 'none';
  document.getElementById('errorMessage').style.display = 'none';

  const currentPassword = document.getElementById('currentPassword').value;
       const newPassword = document.getElementById('newPassword').value;
  const confirmNewPassword = document.getElementById('confirmNewPassword').value;

 // Validate passwords match
       if (newPassword !== confirmNewPassword) {
      document.getElementById('confirmNewPasswordError').textContent = 'Passwords do not match';
     return;
  }

    // Disable submit button
     const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Changing Password...';

            try {
         const response = await fetch('https://localhost:7134/api/member/change-password', {
       method: 'POST',
     headers: {
     'Content-Type': 'application/json'
      },
        credentials: 'include', // Include cookies for session
     body: JSON.stringify({
        currentPassword: currentPassword,
    newPassword: newPassword,
             confirmNewPassword: confirmNewPassword
   })
         });

    const result = await response.json();

     if (response.ok) {
     document.getElementById('successMessage').textContent = result.message;
        document.getElementById('successMessage').style.display = 'block';
       document.getElementById('changePasswordForm').reset();
        
     // Redirect to profile after 2 seconds
     setTimeout(() => {
   window.location.href = 'profile.html';
       }, 2000);
    } else {
            document.getElementById('errorMessage').textContent = result.message || 'Failed to change password';
    document.getElementById('errorMessage').style.display = 'block';
  }
  } catch (error) {
   console.error('Change password error:', error);
document.getElementById('errorMessage').textContent = 'An error occurred. Please try again.';
   document.getElementById('errorMessage').style.display = 'block';
            } finally {
     submitBtn.disabled = false;
  submitBtn.textContent = 'Change Password';
   }
        });
    </script>
</body>
</html>
